---
import Layout from '../../layouts/Layout.astro';
import StructuredData from '../../components/StructuredData.astro';
import FAQ from '../../components/FAQ.astro';
import { siteConfig, businessInfo, services, serviceAreas } from '../../config';

// Generate static pages
export async function getStaticPaths() {
  return serviceAreas.map((area) => ({
    params: { slug: area.slug },
    props: { location: area },
  }));
}

interface Props {
  location: {
    name: string;
    slug: string;
    latitude?: number;
    longitude?: number;
    intro?: string;
    localHighlight?: string;
  };
}

const { location } = Astro.props;
const locationName = location.name;
const coords = {
  lat: location.latitude?.toString() || '51.4019',
  lng: location.longitude?.toString() || '-0.1958',
};

// Meta info
const locationDescription = `Professional on-site tech repair services in ${locationName}. We provide laptop repair, phone repair, and data recovery throughout ${locationName} and nearby areas.`;

// Schema: LocalBusiness + Services
const localBusinessSchema = {
  '@context': 'https://schema.org',
  '@type': 'LocalBusiness',
  name: businessInfo.name,
  description: locationDescription,
  image: `${siteConfig.url}/og-image.jpg`,
  '@id': `${siteConfig.url}/tech-repair-in/${location.slug}/`,
  url: `${siteConfig.url}/tech-repair-in/${location.slug}/`,
  telephone: businessInfo.phone,
  email: businessInfo.email,
  address: {
    '@type': 'PostalAddress',
    streetAddress: businessInfo.address.street,
    addressLocality: businessInfo.address.city,
    postalCode: businessInfo.address.postcode,
    addressCountry: businessInfo.address.country,
  },
  geo: {
    '@type': 'GeoCoordinates',
    latitude: coords.lat,
    longitude: coords.lng,
  },
  areaServed: {
    '@type': 'City',
    name: locationName,
  },
  serviceOffered: services.map((s) => ({
    '@type': 'Service',
    name: s.name,
    description: s.description,
    areaServed: locationName,
  })),
};

const faqData = [
  {
    question: `Do you provide on-site tech repair services in ${locationName}?`,
    answer: `Yes, we provide on-site tech repair services throughout ${locationName} and nearby areas. Our technicians come to your home or office to repair laptops, phones, and other devices.`,
  },
  {
    question: `How quickly can you arrive in ${locationName}?`,
    answer: `We typically schedule visits within 24–48 hours. Same-day service may be available depending on ${locationName} technician availability.`,
  },
  {
    question: `What services do you offer in ${locationName}?`,
    answer: `We offer laptop repair, phone repair, and data recovery in ${locationName}. This includes screen replacement, battery replacement, software issues, and more.`,
  },
  {
    question: `Is there an extra charge for on-site service in ${locationName}?`,
    answer: `There's a small travel fee for on-site service in ${locationName}, always included transparently in your quote.`,
  },
  {
    question: `Can you repair business equipment in ${locationName}?`,
    answer: `Yes, we repair office computers, phones, and other business equipment on-site for companies across ${locationName}.`,
  },
];
---

<Layout 
  title={`Computer & Phone Repairs in ${locationName} | ${businessInfo.name}`}
  description={locationDescription}
  canonical={`${siteConfig.url}/tech-repair-in/${location.slug}/`}
>
  <StructuredData schema={localBusinessSchema} />

  <!-- Hero Section -->
  <section class="py-9 bg-dark-section">
    <div class="container mx-auto px-4">
      <div class="max-w-4xl mx-auto animate-fade-in">
        <div class="flex mb-6">
          <div class="w-32 h-1.5 bg-accent-primary rounded-full"></div>
        </div>
        <h1 class="text-4xl font-bold mb-4 text-dark-primary">Computer & Phone Repairs in {locationName}</h1>
        <p class="text-lg text-dark-secondary mb-8">{locationDescription}</p>
      </div>
    </div>
  </section>

  <!-- Intro & Highlight Section -->
  <section class="py-9 bg-dark-darker scroll-reveal">
    <div class="container mx-auto px-4">
      <div class="max-w-4xl mx-auto">
        {location.intro && (
          <div class="rounded-lg p-6 border-l-4 border-accent-primary mb-6 shadow-card bg-dark-card border-dark">
            <p class="text-dark-secondary text-lg leading-relaxed">{location.intro}</p>
          </div>
        )}
        {location.localHighlight && (
          <div class="rounded-lg p-5 border-l-4 border-accent-primary mb-8 shadow-card bg-dark-card border-dark">
            <p class="text-dark-secondary leading-relaxed">
              <strong class="text-accent-primary">Local Coverage:</strong> {location.localHighlight}
            </p>
          </div>
        )}
      </div>
    </div>
  </section>

  <!-- Services Section -->
  <section class="py-9 bg-dark-section scroll-reveal">
    <div class="container mx-auto px-4">
      <div class="max-w-4xl mx-auto">
        <h2 class="text-2xl font-bold mb-4 text-dark-primary border-b-2 border-accent-primary/30 pb-2 inline-block">Our Services in {locationName}</h2>
        <ul class="space-y-3 text-dark-secondary mt-4">
          {services.map((s) => (
            <li class="flex items-start">
              <span class="text-accent-primary mr-2 mt-1 text-lg font-bold">→</span>
              <span>
                <a href={`/services/${s.slug}/`} class="link-accent text-accent-primary">
                  <strong class="text-dark-primary">{s.name}:</strong>
                </a> {s.description}
              </span>
            </li>
          ))}
        </ul>
      </div>
    </div>
  </section>

  <!-- Why Choose Us Section -->
  <section class="py-9 bg-dark-darker scroll-reveal">
    <div class="container mx-auto px-4">
      <div class="max-w-4xl mx-auto">
        <div class="rounded-lg p-6 border-l-4 border-accent-primary shadow-card bg-dark-card border-dark">
          <h3 class="text-xl font-bold mb-4 text-dark-primary">Why Choose On-Site Service in {locationName}</h3>
          <ul class="text-dark-secondary space-y-2">
            <li class="flex items-start"><span class="text-accent-primary mr-2 text-lg font-bold">•</span><span>No need to travel — we come to you</span></li>
            <li class="flex items-start"><span class="text-accent-primary mr-2 text-lg font-bold">•</span><span>Minimize downtime for home or business devices</span></li>
            <li class="flex items-start"><span class="text-accent-primary mr-2 text-lg font-bold">•</span><span>Transparent pricing and quick turnaround</span></li>
          </ul>
        </div>
      </div>
    </div>
  </section>

  <!-- FAQ Section -->
  <section class="py-9 bg-dark-section scroll-reveal">
    <div class="container mx-auto px-4">
      <div class="max-w-4xl mx-auto">
        <FAQ questions={faqData} variant="dark" />
      </div>
    </div>
  </section>

  <!-- Map Section -->
  <section class="py-9 bg-dark-darker scroll-reveal">
    <div class="container mx-auto px-4">
      <div class="max-w-4xl mx-auto">
        <div class="bg-dark-card rounded-lg p-2 border-2 border-accent-primary/30 shadow-card">
          <iframe
            src={`https://www.google.com/maps?q=${coords.lat},${coords.lng}&z=12&output=embed`}
            width="100%"
            height="300"
            loading="lazy"
            class="rounded-lg"
            style="border: none; display: block; opacity: 1 !important; visibility: visible !important;"
            allowfullscreen=""
            referrerpolicy="no-referrer-when-downgrade"
          ></iframe>
        </div>

        <p class="text-sm text-dark-muted mt-2">
          The map above shows our <strong class="text-dark-primary">service coverage area</strong> for {locationName}. 
          Our main repair shop is located at 
          <a 
            href="https://www.google.com/maps/place/27+London+Rd,+Morden+SM4+5HT" 
            target="_blank" 
            rel="noopener noreferrer"
            class="link-accent text-accent-primary"
          >
            27 London Rd, Morden SM4 5HT
          </a>, 
          where we also welcome walk-in repairs and in-store service.
        </p>

        <div class="mt-12 text-center">
          <a 
            href="/contact" 
            class="btn-primary glow-effect inline-block mr-4"
          >
            Schedule Service in {locationName}
          </a>
          <a 
            href="/locations" 
            class="btn-secondary inline-block"
          >
            Other Service Areas
          </a>
        </div>
      </div>
    </div>
  </section>

  <script>
    // Scroll reveal animation
    const observerOptions = {
      threshold: 0.1,
      rootMargin: '0px 0px -50px 0px'
    };

    const observer = new IntersectionObserver((entries) => {
      entries.forEach(entry => {
        if (entry.isIntersecting) {
          entry.target.classList.add('revealed');
        }
      });
    }, observerOptions);

    document.querySelectorAll('.scroll-reveal').forEach(el => {
      observer.observe(el);
    });
  </script>
</Layout>

